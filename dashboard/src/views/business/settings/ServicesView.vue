<template>
    <div class="p-5">
        <div class="mx-auto px-5 py-5 bg-white border border-border-light rounded-xl">
            <div class="">
                <h1 class="text-xl font-medium">Services Management</h1>
                <p class="text-sm text-secondary mt-2">
                    Manage your services that appear in your WhatsApp booking chatbot
                </p>
            </div>

            <!-- Cards -->
            <div class="flex flex-wrap items-center gap-6 mt-6">
                <div class="border border-border-light flex items-center rounded-lg p-4 gap-3 basis-62 shrink-0">
                    <div class="">
                        <svg width="40" height="40" class="size-10" viewBox="0 0 40 40" fill="none"
                            xmlns="http://www.w3.org/2000/svg">
                            <circle opacity="0.1" cx="20" cy="20" r="20" fill="#335CFF" />
                            <path
                                d="M15.5 13.7001V11.0001C15.5 10.7614 15.5948 10.5325 15.7636 10.3637C15.9324 10.1949 16.1613 10.1001 16.4 10.1001H23.6C23.8387 10.1001 24.0676 10.1949 24.2364 10.3637C24.4052 10.5325 24.5 10.7614 24.5 11.0001V13.7001H28.1C28.3387 13.7001 28.5676 13.7949 28.7364 13.9637C28.9052 14.1325 29 14.3614 29 14.6001V27.2001C29 27.4388 28.9052 27.6677 28.7364 27.8365C28.5676 28.0053 28.3387 28.1001 28.1 28.1001H11.9C11.6613 28.1001 11.4324 28.0053 11.2636 27.8365C11.0948 27.6677 11 27.4388 11 27.2001V14.6001C11 14.3614 11.0948 14.1325 11.2636 13.9637C11.4324 13.7949 11.6613 13.7001 11.9 13.7001H15.5ZM12.8 23.6001V26.3001H27.2V23.6001H12.8ZM12.8 21.8001H27.2V15.5001H12.8V21.8001ZM17.3 11.9001V13.7001H22.7V11.9001H17.3ZM19.1 19.1001H20.9V20.9001H19.1V19.1001Z"
                                fill="#335CFF" />
                        </svg>
                    </div>
                    <div class="space-y-1">
                        <h5 class="text-sm font-medium text-secondary">Total Service</h5>
                        <h3 class="text-2xl font-medium text-strong">03</h3>
                    </div>
                </div>
                <div class="border border-border-light flex items-center rounded-lg p-4 gap-3 basis-62 shrink-0">
                    <div class="">
                        <svg width="40" height="40" class="size-10" viewBox="0 0 40 40" fill="none"
                            xmlns="http://www.w3.org/2000/svg">
                            <circle opacity="0.1" cx="20" cy="20" r="20" fill="#1FC16B" />
                            <path
                                d="M20.0008 11.8999C24.8536 11.8999 28.891 15.3919 29.7379 19.9999C28.8919 24.6079 24.8536 28.0999 20.0008 28.0999C15.148 28.0999 11.1106 24.6079 10.2637 19.9999C11.1097 15.3919 15.148 11.8999 20.0008 11.8999ZM20.0008 26.2999C21.8363 26.2995 23.6173 25.676 25.0523 24.5316C26.4874 23.3871 27.4914 21.7893 27.9001 19.9999C27.4899 18.2119 26.4852 16.6159 25.0503 15.4729C23.6155 14.3299 21.8352 13.7076 20.0008 13.7076C18.1663 13.7076 16.3861 14.3299 14.9512 15.4729C13.5163 16.6159 12.5117 18.2119 12.1015 19.9999C12.5102 21.7893 13.5142 23.3871 14.9492 24.5316C16.3842 25.676 18.1653 26.2995 20.0008 26.2999ZM20.0008 24.0499C18.9266 24.0499 17.8965 23.6232 17.137 22.8637C16.3775 22.1042 15.9508 21.074 15.9508 19.9999C15.9508 18.9258 16.3775 17.8956 17.137 17.1361C17.8965 16.3766 18.9266 15.9499 20.0008 15.9499C21.0749 15.9499 22.105 16.3766 22.8646 17.1361C23.6241 17.8956 24.0508 18.9258 24.0508 19.9999C24.0508 21.074 23.6241 22.1042 22.8646 22.8637C22.105 23.6232 21.0749 24.0499 20.0008 24.0499ZM20.0008 22.2499C20.5975 22.2499 21.1698 22.0128 21.5918 21.5909C22.0137 21.1689 22.2508 20.5966 22.2508 19.9999C22.2508 19.4032 22.0137 18.8309 21.5918 18.4089C21.1698 17.987 20.5975 17.7499 20.0008 17.7499C19.404 17.7499 18.8317 17.987 18.4098 18.4089C17.9878 18.8309 17.7508 19.4032 17.7508 19.9999C17.7508 20.5966 17.9878 21.1689 18.4098 21.5909C18.8317 22.0128 19.404 22.2499 20.0008 22.2499Z"
                                fill="#1FC16B" />
                        </svg>
                    </div>
                    <div class="space-y-1">
                        <h5 class="text-sm font-medium text-secondary">Total Service</h5>
                        <h3 class="text-2xl font-medium text-strong">03</h3>
                    </div>
                </div>
                <div class="border border-border-light flex items-center rounded-lg p-4 gap-3 basis-62 shrink-0">
                    <div class="">
                        <svg width="40" height="40" class="size-10" viewBox="0 0 40 40" fill="none"
                            xmlns="http://www.w3.org/2000/svg">
                            <circle opacity="0.1" cx="20" cy="20" r="20" fill="#FB3748" />
                            <path
                                d="M25.2946 26.5672C23.7117 27.5712 21.8752 28.1029 20.0008 28.0999C15.148 28.0999 11.1106 24.6079 10.2637 19.9999C10.6507 17.9036 11.7051 15.9885 13.2697 14.5405L10.4536 11.7271L11.7271 10.4536L29.5462 28.2736L28.2727 29.5462L25.2937 26.5672H25.2946ZM14.5423 15.8149C13.3192 16.9269 12.4672 18.3878 12.1015 19.9999C12.3825 21.2297 12.9468 22.3769 13.7494 23.3502C14.5519 24.3236 15.5706 25.0961 16.7244 25.6063C17.8781 26.1165 19.135 26.3504 20.3951 26.2892C21.6551 26.2281 22.8835 25.8736 23.9824 25.2541L22.1572 23.4289C21.3802 23.9183 20.46 24.1292 19.5474 24.0269C18.6348 23.9246 17.7841 23.5152 17.1348 22.8659C16.4855 22.2166 16.0761 21.3659 15.9738 20.4533C15.8715 19.5407 16.0823 18.6205 16.5718 17.8435L14.5423 15.8149ZM20.8234 22.0951L17.9056 19.1773C17.7454 19.585 17.7077 20.0305 17.7971 20.4592C17.8865 20.888 18.0991 21.2813 18.4088 21.591C18.7185 21.9007 19.1118 22.1133 19.5406 22.2027C19.9693 22.292 20.4148 22.2544 20.8225 22.0942L20.8234 22.0951ZM27.9271 24.1327L26.6392 22.8457C27.2408 21.9883 27.6691 21.0216 27.9001 19.9999C27.6555 18.9287 27.1956 17.9183 26.5484 17.0304C25.9012 16.1424 25.0802 15.3953 24.1353 14.8345C23.1903 14.2736 22.1412 13.9108 21.0517 13.7681C19.9622 13.6254 18.8551 13.7057 17.7976 14.0041L16.3774 12.5839C17.4997 12.1429 18.7228 11.8999 20.0008 11.8999C24.8536 11.8999 28.891 15.3919 29.7379 19.9999C29.4621 21.499 28.8422 22.9137 27.9271 24.1327ZM19.7515 15.9571C20.3243 15.9217 20.8982 16.0085 21.435 16.2116C21.9717 16.4148 22.4592 16.7298 22.8651 17.1356C23.2709 17.5415 23.5859 18.0289 23.789 18.5657C23.9922 19.1025 24.079 19.6764 24.0436 20.2492L19.7506 15.9571H19.7515Z"
                                fill="#FB3748" />
                        </svg>
                    </div>
                    <div class="space-y-1">
                        <h5 class="text-sm font-medium text-secondary">Total Service</h5>
                        <h3 class="text-2xl font-medium text-strong">03</h3>
                    </div>
                </div>
            </div>

            <!-- Filters -->
            <div class="mt-6 flex flex-wrap items-center gap-3">
                <!-- Search -->
                <div class="">
                    <form class="border border-border-light flex items-center gap-2 p-2 rounded-lg">
                        <label for="search">
                            <svg width="20" height="20" viewBox="0 0 20 20" fill="none"
                                xmlns="http://www.w3.org/2000/svg">
                                <path
                                    d="M9.25 2.5C12.976 2.5 16 5.524 16 9.25C16 12.976 12.976 16 9.25 16C5.524 16 2.5 12.976 2.5 9.25C2.5 5.524 5.524 2.5 9.25 2.5ZM9.25 14.5C12.1502 14.5 14.5 12.1502 14.5 9.25C14.5 6.349 12.1502 4 9.25 4C6.349 4 4 6.349 4 9.25C4 12.1502 6.349 14.5 9.25 14.5ZM15.6137 14.5532L17.7355 16.6742L16.6742 17.7355L14.5532 15.6137L15.6137 14.5532Z"
                                    fill="#99A0AE" />
                            </svg>
                        </label>
                        <input type="search" name="search" id="search"
                            class="bg-transparent text-sm block w-full focus:border-none focus:outline-none"
                            placeholder="Search team members">
                    </form>
                </div>

                <div class="grow"></div>

                <!-- Filters -->
                <FilterAllTeamMembers />
                <FilterByStatus />
                <FilterByTypes />
                <ButtonPrimary @click="modalAddService = true">
                    <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M9.25 9.25V4.75H10.75V9.25H15.25V10.75H10.75V15.25H9.25V10.75H4.75V9.25H9.25Z"
                            fill="white" />
                    </svg>
                    <span class="px-1 hidden lg:block">Add Service</span>
                </ButtonPrimary>
            </div>

            <div class="mt-5 space-y-3.5 overflow-x-auto">
                <!-- Team Table -->
                <div class="border border-light rounded-lg" v-if="services.length == 0">
                    <div class="flex flex-col items-center pt-15 pb-10">
                        <svg width="48" height="48" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <rect x="0.5" y="0.5" width="47" height="47" rx="11.5" fill="#F5F7FA" />
                            <rect x="0.5" y="0.5" width="47" height="47" rx="11.5" stroke="#E1E4EA" />
                            <path
                                d="M32.4001 34.5002H30.3001V32.4002C30.3001 31.5648 29.9682 30.7635 29.3775 30.1728C28.7867 29.5821 27.9855 29.2502 27.1501 29.2502H20.8501C20.0147 29.2502 19.2135 29.5821 18.6227 30.1728C18.032 30.7635 17.7001 31.5648 17.7001 32.4002V34.5002H15.6001V32.4002C15.6001 31.0078 16.1532 29.6724 17.1378 28.6879C18.1224 27.7033 19.4577 27.1502 20.8501 27.1502H27.1501C28.5425 27.1502 29.8778 27.7033 30.8624 28.6879C31.847 29.6724 32.4001 31.0078 32.4001 32.4002V34.5002ZM24.0001 25.0502C23.1728 25.0502 22.3535 24.8872 21.5892 24.5706C20.8248 24.254 20.1303 23.79 19.5453 23.205C18.9603 22.62 18.4963 21.9255 18.1797 21.1611C17.8631 20.3967 17.7001 19.5775 17.7001 18.7502C17.7001 17.9229 17.8631 17.1036 18.1797 16.3393C18.4963 15.5749 18.9603 14.8804 19.5453 14.2954C20.1303 13.7104 20.8248 13.2464 21.5892 12.9298C22.3535 12.6131 23.1728 12.4502 24.0001 12.4502C25.671 12.4502 27.2734 13.1139 28.4549 14.2954C29.6364 15.4769 30.3001 17.0793 30.3001 18.7502C30.3001 20.4211 29.6364 22.0235 28.4549 23.205C27.2734 24.3864 25.671 25.0502 24.0001 25.0502ZM24.0001 22.9502C25.114 22.9502 26.1823 22.5077 26.9699 21.72C27.7576 20.9324 28.2001 19.8641 28.2001 18.7502C28.2001 17.6363 27.7576 16.568 26.9699 15.7803C26.1823 14.9927 25.114 14.5502 24.0001 14.5502C22.8862 14.5502 21.8179 14.9927 21.0302 15.7803C20.2426 16.568 19.8001 17.6363 19.8001 18.7502C19.8001 19.8641 20.2426 20.9324 21.0302 21.72C21.8179 22.5077 22.8862 22.9502 24.0001 22.9502Z"
                                fill="#335CFF" />
                        </svg>
                        <h4 class="text-xl font-medium text-strong mt-4 text-center">No Services Added Yet</h4>
                        <p class="text-sm text-secondary mt-1 text-center">
                            Add new services that will be appear into chatbot
                        </p>
                        <div class="mt-5">
                            <ButtonPrimary @click="modalAddService = true">
                                <svg width="20" height="20" viewBox="0 0 20 20" fill="none"
                                    xmlns="http://www.w3.org/2000/svg">
                                    <path
                                        d="M9.25 9.25V4.75H10.75V9.25H15.25V10.75H10.75V15.25H9.25V10.75H4.75V9.25H9.25Z"
                                        fill="white" />
                                </svg>
                                <span class="px-1 hidden lg:block">Add New Service</span>
                            </ButtonPrimary>
                        </div>
                    </div>
                </div>
                <div v-else class="min-w-full inline-block align-middle space-y-4">
                    <template v-for="(item, index) in services" :key="index">
                        <ServiceRow :service="item" @delete="services.splice(index, 1)"
                            @edit="modalEditService = item" />
                    </template>
                </div>
            </div>
        </div>
    </div>

    <Modal v-model="modalAddService">
        <FormServiceAdd @close="modalAddService = false" @save="onSave" />
    </Modal>

    <Modal v-model="modalEditService">
        <FormServiceEdit :service="modalEditService" @close="modalEditService = null" @save="onSave" />
    </Modal>
</template>

<script setup lang="ts">
import { ref } from 'vue'
import Modal from '@/components/Modal.vue'
import ButtonPrimary from '@/components/shared/ButtonPrimary.vue'
import FormServiceAdd from '@/components/forms/FormServiceAdd.vue'
import { useServicesStore, type Service } from '@/stores/services'
import ServiceRow from '@/components/services/ServiceRow.vue'
import FormServiceEdit from '@/components/forms/FormServiceEdit.vue'
import FilterAllTeamMembers from '@/components/services/FilterAllTeamMembers.vue'
import FilterByStatus from '@/components/services/FilterByStatus.vue'
import FilterByTypes from '@/components/services/FilterByTypes.vue'

const modalAddService = ref(false)
const modalEditService = ref<Service | null>(null)
const { db_services } = useServicesStore()
const services = ref<Service[]>(db_services)

let id = 0

async function onSave(value: Service) {
    if (!value) return

    modalAddService.value = false
    value.id = ++id
    services.value.push(value)
}
</script>